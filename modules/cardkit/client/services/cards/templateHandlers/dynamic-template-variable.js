// e.g. loadDynamicTemplate('[data-dynamic-template]', 'Aaron Harris');

window.loadDynamicTemplate = function(container, client) {
    if (!container || !client) return;

    var $container = $(container).empty();
    var cardUrl = $container.attr('data-dynamic-template');
    if (!cardUrl) return;

    if (cardUrl.startsWith('{{')) return;

    var cardRequest = $.ajax({
        type: 'GET',
        url: '/cards/json/' + client + '/' + cardUrl,
        dataType: 'json',
        cache: false
    });

    return $.when(cardRequest).then(function(cardResponse) {
        var card = cardResponse || {};
        var template = card['Html Markup'];
        if (card.css) $(document.createElement('style')).html(card.css).appendTo($container);
        var html = template || '';
        $('<div>').html(html).addClass('autogenerated').appendTo($container);
        $container.triggerHandler('loaded');
    });
};
